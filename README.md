[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

# simplegoogleidtoken

simplegoogleidtoken is a lightweight Java library for effortlessly exchanging Google Cloud Service Account credentials for Google ID tokens

## Purpose

This library is intended to simplify the process of exchanging Google Cloud Service Account credentials for Google ID tokens. It is configurable so when used in GCP the service account assigned to the infrastructure can be used to generate the Google ID token.  When used in other envirioment the service account credentials JSON file can be provided and used to request the Google ID token.

The tokens are generated by calling the Google `https://oauth2.googleapis.com/token` endpoint with the `urn:ietf:params:oauth:grant-type:jwt-bearer` grant type specifying a target audience that is included in the ID token.

The issuer of these tokens will be `https://accounts.google.com` which has a JWKS endpoint available at `https://www.googleapis.com/oauth2/v3/certs`.

## Getting Started

This library requires Java 17.

It is not yet available on Maven Central.

When utilizing this library and running on GCP the `google-auth-library-oauth2-http` library is required.  This library is available on Maven Central and must be included in addition to `simplegoogleidtoken`.

```xml
<dependency>
    <groupId>com.google.auth</groupId>
    <artifactId>google-auth-library-oauth2-http</artifactId>
    <version>1.23.0</version>
</dependency>
```

## Usage

This library provides `SimpleGoogleIdToken` which uses `SimpleRequest` to specify the target audience and `SimpleResponse` to return the ID token.  In the case of an error the `SimpleSignException` or SimpleExchangeException` will be throw.

When running on GCP this library can utilize the metadata service to obtain the ID tokens without the need to have the service account credentials JSON file.  The default behavior for `SimpleGoogleIdToken` is to use the metadata service to obtain the ID token using the `ServiceAccountDefaultGoogleCredentialsConfig` configuration object which does not need to explicitly be provided.

```java
package example;

import com.unitvectory.simplegoogleidtoken.SimpleGoogleIdToken;
import com.unitvectory.simplegoogleidtoken.SimpleRequest;

public class GCPExample {

    public String getIdToken() {

        String audience = "https://example.com";

        SimpleGoogleIdToken simpleGoogleIdToken = SimpleGoogleIdToken.builder().build();

        String idToken = simpleGoogleIdToken
                .getIdToken(SimpleRequest.builder().withTargetAudience(audience).build()).getIdToken();

        return idToken;
    }
}
```

When running outside of GCP the service account credentials JSON file can be provided to the library.  The `ServiceAccountFileConfig` configuration object can be used to provide the path to the service account credentials JSON file. Alternatively `ServiceAccountJsonConfig` can be used to provide the service account credentials JSON as a string directly.

```java
package example;

import com.unitvectory.simplegoogleidtoken.ServiceAccountFileConfig;
import com.unitvectory.simplegoogleidtoken.SimpleGoogleIdToken;
import com.unitvectory.simplegoogleidtoken.SimpleRequest;

public class LocalExample {

    public String getIdToken(String serviceAccountKeyFilePath) {

        String audience = "https://example.com";

        SimpleGoogleIdToken simpleGoogleIdToken = SimpleGoogleIdToken.builder().withServiceAccountConfig(
                ServiceAccountFileConfig.builder().withFilePath(serviceAccountKeyFilePath).build()).build();

        String idToken = simpleGoogleIdToken
                .getIdToken(SimpleRequest.builder().withTargetAudience(audience).build()).getIdToken();

        return idToken;
    }
}
```
